<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">

    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!--icon-->

    
        <link rel="shortcut icon" href="/images/favicon.ico">
    
    
        <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    
    
        <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    
    
        <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    
    


    <!-- meta -->


<title>Python逆向 | 早点睡zZZ</title>


    <meta name="keywords" content="Knowledge">




    <!-- OpenGraph -->
 
    <meta name="description" content="感觉好久没有好好做过 CTF 了，想念那种坐牢的感觉了（楽🙇‍♀️">
<meta property="og:type" content="article">
<meta property="og:title" content="Python逆向">
<meta property="og:url" content="https://ghdemi.github.io/2022/11/05/Python%E9%80%86%E5%90%91/index.html">
<meta property="og:site_name" content="早点睡zZZ">
<meta property="og:description" content="感觉好久没有好好做过 CTF 了，想念那种坐牢的感觉了（楽🙇‍♀️">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/GhDemi/Picture@main/BlogImg/PythonRe.jpg">
<meta property="article:published_time" content="2022-11-05T13:17:08.000Z">
<meta property="article:modified_time" content="2022-11-05T13:34:31.000Z">
<meta property="article:author" content="GhDemi">
<meta property="article:tag" content="Knowledge">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/GhDemi/Picture@main/BlogImg/PythonRe.jpg">


    
<link rel="stylesheet" href="/css/style/main.css">
 

    
    
        <link rel="stylesheet" id="hl-default-theme" href="/css/highlight/default.css" media="none" >
        
            <link rel="stylesheet" id="hl-dark-theme" href="/css/highlight/dark.css" media="none">
        
    

    
    

    
    
<link rel="stylesheet" href="/css/style/dark.css">

    
<script src="/js/darkmode.js"></script>



     

    <!-- custom head -->

<meta name="generator" content="Hexo 6.1.0"></head>

    <body>
        <div id="app">
            <header class="header">
    <div class="header__left">
        <a href="/" class="button">
            <span class="logo__text">Hi!</span>
        </a>
    </div>
    <div class="header__right">
        
            <div class="navbar__menus">
                
                    <a href="/" class="navbar-menu button">首页</a>
                
                    <a href="/tags/" class="navbar-menu button">标签</a>
                
                    <a href="/categories/" class="navbar-menu button">分类</a>
                
                    <a href="/archives/" class="navbar-menu button">归档</a>
                
                    <a href="/friends/" class="navbar-menu button">友链</a>
                
                    <a href="/about/" class="navbar-menu button">关于</a>
                
            </div>
        
        
        

        
        
    <a href="javaScript:void(0);" id="btn-toggle-dark">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </a>


        
            <a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width='24' height='24' fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a>
            <div class="dropdown-menus" id="dropdown-menus">
                
                    <a href="/" class="dropdown-menu button">首页</a>
                
                    <a href="/tags/" class="dropdown-menu button">标签</a>
                
                    <a href="/categories/" class="dropdown-menu button">分类</a>
                
                    <a href="/archives/" class="dropdown-menu button">归档</a>
                
                    <a href="/friends/" class="dropdown-menu button">友链</a>
                
                    <a href="/about/" class="dropdown-menu button">关于</a>
                
            </div>
        
    </div>
</header>


            <main class="main">
    

<div class="post-title">
    <h1 class="post-title__text">
        Python逆向
    </h1>
    <div class="post-title__meta">
        <a href="/archives/2022/11/" class="post-meta__date button">2022-11-05</a>
        
    <span class="separate-dot"></span><a href="/categories/Re-Point/" class="button">Re_Point</a>

 
        
    
    


 

 
    </div>
</div>


    <aside class="post-side">
        <div class="post-side__toc">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#python-%E6%B1%87%E7%BC%96"><span class="toc-text">python 汇编</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF-python-%E9%80%86%E5%90%91"><span class="toc-text">纯 python 逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E8%BF%9B%E8%A1%8C%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-text">使用工具进行反编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python-%E6%B1%87%E7%BC%96%E8%BF%98%E5%8E%9F-py-%E6%96%87%E4%BB%B6"><span class="toc-text">python 汇编还原 py 文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E4%BA%BF%E7%82%B9%E7%82%B9%E9%9A%BE%E5%BA%A6"><span class="toc-text">增加亿点点难度</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-v2"><span class="toc-text">小结</span></a></li></ol>
        </div>
    </aside>
    <a class="btn-toc button" id="btn-toc" tabindex="0">
        <svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path>
        </svg>
    </a>
    <div class="toc-menus" id="toc-menus">
        <div class="toc-title">文章目录</div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#python-%E6%B1%87%E7%BC%96"><span class="toc-text">python 汇编</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF-python-%E9%80%86%E5%90%91"><span class="toc-text">纯 python 逆向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E8%BF%9B%E8%A1%8C%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-text">使用工具进行反编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python-%E6%B1%87%E7%BC%96%E8%BF%98%E5%8E%9F-py-%E6%96%87%E4%BB%B6"><span class="toc-text">python 汇编还原 py 文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E4%BA%BF%E7%82%B9%E7%82%B9%E9%9A%BE%E5%BA%A6"><span class="toc-text">增加亿点点难度</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-v2"><span class="toc-text">小结</span></a></li></ol>
    </div>


<article class="post post__with-toc content-card">
    <div class="post__header">
    
        <div class="post-thumbnail" style="background-image: url('https://cdn.jsdelivr.net/gh/GhDemi/Picture@main/BlogImg/PythonRe.jpg');"></div>
    
</div>
    <div class="post__content">
        <p>感觉好久没有好好做过 CTF 了，想念那种坐牢的感觉了（楽🙇‍♀️</p>
<span id="more"></span>
<p>第一次认真接触算是在省赛的时候吧，当时给的是一个 exe 类型的文件，通过 pyinstaller 将它转变成 .pyc 文件之后由于没有工具可以把它变成 .py 文件，也不知道有 dis 这个库可以将 pyc 文件转换成 python汇编，所以当时就 g 掉了。</p>
<p>省赛连续两年都出了相关的题目，是得了解一下了</p>
<h2 id="python-汇编">python 汇编</h2>
<p>pyc 是二进制文件，可以直接由 python 虚拟机来执行。显而易见，这种玩应我们是看不懂的，通过一些工具，例如：uncompyle6。通过命令 <code>uncompyle6 -o xxxx.py xxxx.pyc</code>  就可以将 pyc 文件直接转换为 py 文件，那逆向难度就直接降低了，只要看懂 py 文件就可以了。但是这都是最理想的状态，如果我们对 pyc 文件进行一些<a target="_blank" rel="noopener" href="https://blog.csdn.net/lclfans1983/article/details/107255346">防止反编译的操作</a>导致 uncompyle6 没有办法工作，那么我们就只能通过分析 python 汇编还原出基本的 py 文件。</p>
<p>通过 python 中的 dis 模块，可以将 pyc 文件转换为 python 汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2           0 LOAD_CONST               1 (&#x27;1234abcd&#x27;)</span><br><span class="line">            2 STORE_FAST               0 (str)</span><br><span class="line"></span><br><span class="line">3           4 LOAD_GLOBAL              0 (range)</span><br><span class="line">            6 LOAD_FAST                0 (str)</span><br><span class="line">            8 CALL_FUNCTION            1</span><br><span class="line">           10 GET_ITER</span><br><span class="line">      &gt;&gt;   12 FOR_ITER                 6 (to 26)</span><br><span class="line">           14 STORE_FAST               1 (i)</span><br><span class="line"></span><br><span class="line">4          16 LOAD_GLOBAL              1 (print)</span><br><span class="line">           18 LOAD_FAST                1 (i)</span><br><span class="line">           20 CALL_FUNCTION            1</span><br><span class="line">           22 POP_TOP</span><br><span class="line">           24 JUMP_ABSOLUTE            6 (to 12)</span><br></pre></td></tr></table></figure>
<p>句子的结构如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">源码行号 | 指令在函数中的偏移 | 指令符号 | 指令参数 | 实际参数值</span><br></pre></td></tr></table></figure>
<h2 id="纯-python-逆向">纯 python 逆向</h2>
<p>很简单的一个 py 文件逆向，直接对照 py 文件写出相对应的 exp 即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">print &#x27;Welcome to Re World!&#x27;</span><br><span class="line">print &#x27;Your input1 is your flag~&#x27;</span><br><span class="line">l = len(input1)</span><br><span class="line">for i in range(l):  </span><br><span class="line">    num = ((input1[i] + i) % 128 + 128) % 128</span><br><span class="line">    code += num</span><br><span class="line"></span><br><span class="line">for i in range(l - 1):</span><br><span class="line">    code[i] = code[i] ^ code[(i + 1)]</span><br><span class="line"></span><br><span class="line">print code</span><br><span class="line">code = [&#x27;\x1f&#x27;, &#x27;\x12&#x27;, &#x27;\x1d&#x27;, &#x27;(&#x27;, &#x27;0&#x27;, &#x27;4&#x27;, &#x27;\x01&#x27;, &#x27;\x06&#x27;, &#x27;\x14&#x27;, &#x27;4&#x27;, &#x27;,&#x27;, &#x27;\x1b&#x27;, &#x27;U&#x27;, &#x27;?&#x27;, &#x27;o&#x27;, &#x27;6&#x27;, &#x27;*&#x27;, &#x27;:&#x27;, &#x27;\x01&#x27;, &#x27;D&#x27;, &#x27;;&#x27;, &#x27;%&#x27;, &#x27;\x13&#x27;]</span><br></pre></td></tr></table></figure>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">code = [&#x27;\x1f&#x27;, &#x27;\x12&#x27;, &#x27;\x1d&#x27;, &#x27;(&#x27;, &#x27;0&#x27;, &#x27;4&#x27;, &#x27;\x01&#x27;, &#x27;\x06&#x27;, &#x27;\x14&#x27;, &#x27;4&#x27;, &#x27;,&#x27;, &#x27;\x1b&#x27;, &#x27;U&#x27;, &#x27;?&#x27;, &#x27;o&#x27;, &#x27;6&#x27;, &#x27;*&#x27;, &#x27;:&#x27;, &#x27;\x01&#x27;, &#x27;D&#x27;, &#x27;;&#x27;, &#x27;%&#x27;, &#x27;\x13&#x27;]</span><br><span class="line">code = [ord(x) for x in code]</span><br><span class="line"></span><br><span class="line">for i in range(len(code)-2, -1, -1):  </span><br><span class="line">    code[i] ^= code[i+1]</span><br><span class="line">    # code[i] = code[i]%128</span><br><span class="line"></span><br><span class="line">for i in range(len(code)):</span><br><span class="line">    code[i] -= i</span><br><span class="line">    if code[i] &lt; 0:</span><br><span class="line">        code[i] += 128</span><br><span class="line">    code[i] = code[i]%128</span><br><span class="line">print(code)</span><br><span class="line">print(&quot;&quot;.join([chr(x) for x in code]))</span><br></pre></td></tr></table></figure>
<h2 id="使用工具进行反编译">使用工具进行反编译</h2>
<p>在前面的 python 汇编里简单介绍了 uncompyle6 的使用，这里介绍另一个工具 pycdc</p>
<p>通过命令下载 pycdc，或者直接下载 zip 包解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/zrax/pycdc.git</span><br></pre></td></tr></table></figure>
<p>执行命令安装 cmake</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install cmake</span><br></pre></td></tr></table></figure>
<p>进入下载 \ 解压缩的文件夹中，执行命令生成 CMakeFiles</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake .</span><br></pre></td></tr></table></figure>
<p>之后就可以利用 pycdc 对 pyc 文件进行反编译了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./pycdc &lt;pyc path&gt;</span><br></pre></td></tr></table></figure>
<p>就可以得到 python 原始代码了，得到原始代码之后的操作步骤就和上面的纯 python 逆向一样了</p>
<p><img src="image-20221105163152219.png" alt="image-20221105163152219"></p>
<p>geek大挑战2020_python1，反编译之后得到的原始代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def b(a):</span><br><span class="line">    return a &amp; 0xFFFFFFFFFFFFFFFF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def c(str):</span><br><span class="line">    return struct.unpack(&#x27;&lt;Q&#x27;, str)[0]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def d(a):</span><br><span class="line">    for i in range(64):</span><br><span class="line">        a = a * 2</span><br><span class="line">        if a &gt; 0xFFFFFFFFFFFFFFFF:</span><br><span class="line">            a = b(a)</span><br><span class="line">            a = b(a ^ 0xB0004B7679FA26B3)</span><br><span class="line">            continue</span><br><span class="line">    return a</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    cmp_data = [</span><br><span class="line">        0x6E8DD76D3B876F95,</span><br><span class="line">        0xE206DA09DAF4BED6,</span><br><span class="line">        0x77559D346E134BF1,</span><br><span class="line">        0x61CE39CAC5EAF891,</span><br><span class="line">        0x656C3C155520E36F]</span><br><span class="line">    input = raw_input(&#x27;plz input your flag:&#x27;)</span><br><span class="line">    if len(input) % 8 != 0:</span><br><span class="line">        for i in range(8 - len(input) % 8):</span><br><span class="line">            input += &#x27;\x00&#x27;</span><br><span class="line">        </span><br><span class="line">    arr = []</span><br><span class="line">    for i in range(len(input) / 8):</span><br><span class="line">        value = d(c(input[i * 8:i * 8 + 8]))</span><br><span class="line">        arr.append(value)</span><br><span class="line">    </span><br><span class="line">    for i in range(5):</span><br><span class="line">        if arr[i] != cmp_data[i]:</span><br><span class="line">            print &#x27;fail&#x27;</span><br><span class="line">            time.sleep(5)</span><br><span class="line">            exit()</span><br><span class="line">            continue</span><br><span class="line">    print &#x27;success&#x27;</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure>
<p>个人觉得 pycdc 比 uncompyle6 更加友好，反编译的内容和精确度也更胜一筹👍</p>
<p>这道 python 逆向的难点就在于加密的时候看起来好像是没有判断是否有进入过函数 d(a) 的 if 语句中的，但实际上，如果有经过这个 if 分支，那么出来的数字就必定为奇数，如果没有，那么出来的数字就必定为偶数。</p>
<p>按照这个理论，我们就可以编写出 exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line">def re_d(a):</span><br><span class="line">    for _ in range(64):</span><br><span class="line">        if (a%2 == 1):  # 若为奇数</span><br><span class="line">            tmp = a ^ 0xB0004B7679FA26B3</span><br><span class="line">            a = tmp + 0xFFFFFFFFFFFFFFFF + 1</span><br><span class="line">        a = a//2 </span><br><span class="line">    return a</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmp_data = [</span><br><span class="line">    0x6E8DD76D3B876F95,</span><br><span class="line">    0xE206DA09DAF4BED6,</span><br><span class="line">    0x77559D346E134BF1,</span><br><span class="line">    0x61CE39CAC5EAF891,</span><br><span class="line">    0x656C3C155520E36F]</span><br><span class="line"></span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in cmp_data:</span><br><span class="line">    tmp = re_d(i)</span><br><span class="line">    print(hex(tmp))</span><br><span class="line">    flag += struct.pack(&#x27;&lt;Q&#x27;,tmp).decode(&quot;utf-8&quot;)</span><br><span class="line"></span><br><span class="line">    print(&quot;flag:&quot;,flag)</span><br></pre></td></tr></table></figure>
<h2 id="python-汇编还原-py-文件">python 汇编还原 py 文件</h2>
<p>当然了，上面都是最理想的一种状态因为可以直接得到 py 文件，下面来说说通过 python 字节码还原 py 文件。</p>
<p>上面也已经介绍了 python 汇编语句的格式，也有<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-246683.htm#msg_header_h3_9">文章</a>将 python 汇编各种语言类型进行了总结，以及官网 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/dis.html">dis</a> 模块也给出了字节码指令的解释，对照着这些就可以将 pyc 文件所转换的 python 汇编还原成 py 文件。</p>
<p>下面对一个例子进行逐句分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">1           0 LOAD_CONST               0 (&lt;code object keyinit at 0x0000028C1CC11D20, file &quot;crackPYC.py&quot;, line 1&gt;)          //载入函数内容</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;keyinit&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0  //定义函数</span><br><span class="line">              6 STORE_NAME               0 (keyinit) //存储函数</span><br><span class="line"></span><br><span class="line">  8           8 LOAD_NAME                1 (__name__)</span><br><span class="line">             10 LOAD_CONST               2 (&#x27;__main__&#x27;)</span><br><span class="line">             12 COMPARE_OP               2 (==)</span><br><span class="line">             14 POP_JUMP_IF_FALSE      250        // if __name__ ==&#x27;__name__&#x27;</span><br><span class="line"></span><br><span class="line">  9          16 LOAD_NAME                2 (print)</span><br><span class="line">             18 LOAD_CONST               3 (&#x27;Can you crack pyc?&#x27;)</span><br><span class="line">             20 CALL_FUNCTION            1</span><br><span class="line">             22 POP_TOP                      // print(&#x27;Can you crack pyc?&#x27;)</span><br><span class="line"></span><br><span class="line"> 10          24 LOAD_NAME                3 (input)</span><br><span class="line">             26 LOAD_CONST               4 (&#x27;Plz give me your flag:&#x27;)</span><br><span class="line">             28 CALL_FUNCTION            1</span><br><span class="line">             30 STORE_NAME               4 (str)    // str=input(&#x27;Plz give me your flag:&#x27;)</span><br><span class="line"></span><br><span class="line"> 11          32 LOAD_CONST               5 (108)</span><br><span class="line">             34 LOAD_CONST               6 (17)</span><br><span class="line">             36 LOAD_CONST               7 (42)</span><br><span class="line">             38 LOAD_CONST               8 (226)</span><br><span class="line">             40 LOAD_CONST               9 (158)</span><br><span class="line">             42 LOAD_CONST              10 (180)</span><br><span class="line">             44 LOAD_CONST              11 (96)</span><br><span class="line">             46 LOAD_CONST              12 (115)</span><br><span class="line">             48 LOAD_CONST              13 (64)</span><br><span class="line">             50 LOAD_CONST              14 (24)</span><br><span class="line">             52 LOAD_CONST              15 (38)</span><br><span class="line">             54 LOAD_CONST              16 (236)</span><br><span class="line">             56 LOAD_CONST              17 (179)</span><br><span class="line">             58 LOAD_CONST              18 (173)</span><br><span class="line">             60 LOAD_CONST              19 (34)</span><br><span class="line">             62 LOAD_CONST              20 (22)</span><br><span class="line">             64 LOAD_CONST              21 (81)</span><br><span class="line">             66 LOAD_CONST              22 (113)</span><br><span class="line">             68 LOAD_CONST              15 (38)</span><br><span class="line">             70 LOAD_CONST              23 (215)</span><br><span class="line">             72 LOAD_CONST              24 (165)</span><br><span class="line">             74 LOAD_CONST              25 (135)</span><br><span class="line">             76 LOAD_CONST              26 (68)</span><br><span class="line">             78 LOAD_CONST              27 (7)</span><br><span class="line"></span><br><span class="line"> 12          80 LOAD_CONST              28 (119)</span><br><span class="line">             82 LOAD_CONST              29 (97)</span><br><span class="line">             84 LOAD_CONST              30 (45)</span><br><span class="line">             86 LOAD_CONST              31 (254)</span><br><span class="line">             88 LOAD_CONST              32 (250)</span><br><span class="line">             90 LOAD_CONST              33 (172)</span><br><span class="line">             92 LOAD_CONST              34 (43)</span><br><span class="line">             94 LOAD_CONST              35 (62)</span><br><span class="line">             96 BUILD_LIST              32</span><br><span class="line">             98 STORE_NAME               5 (text)  // text=[108, 17, 42, ... , 172, 43, 62]</span><br><span class="line"></span><br><span class="line"> 13         100 LOAD_NAME                6 (len)</span><br><span class="line">            102 LOAD_NAME                4 (str)</span><br><span class="line">            104 CALL_FUNCTION            1</span><br><span class="line">            106 LOAD_CONST              36 (32)</span><br><span class="line">            108 COMPARE_OP               3 (!=)</span><br><span class="line">            110 POP_JUMP_IF_TRUE       140        // if(len(str) != 32)</span><br><span class="line">            112 LOAD_NAME                4 (str)</span><br><span class="line">            114 LOAD_CONST              37 (0)</span><br><span class="line">            116 LOAD_CONST              27 (7)</span><br><span class="line">            118 BUILD_SLICE              2</span><br><span class="line">            120 BINARY_SUBSCR                    // TOS = str[0:7]</span><br><span class="line">            122 LOAD_CONST              38 (&#x27;DASCTF&#123;&#x27;)</span><br><span class="line">            124 COMPARE_OP               3 (!=)</span><br><span class="line">            126 POP_JUMP_IF_TRUE       140      // if(TOS != &#x27;DASCTF&#123;&#x27;)</span><br><span class="line">            128 LOAD_NAME                4 (str)</span><br><span class="line">            130 LOAD_CONST              39 (31)</span><br><span class="line">            132 BINARY_SUBSCR                   // TOS = str[31]</span><br><span class="line">            134 LOAD_CONST              40 (&#x27;&#125;&#x27;)</span><br><span class="line">            136 COMPARE_OP               3 (!=)</span><br><span class="line">            138 POP_JUMP_IF_FALSE      154      // if(TOS != &#x27;&#123;&#x27;)</span><br><span class="line"></span><br><span class="line"> 14     &gt;&gt;  140 LOAD_NAME                2 (print)</span><br><span class="line">            142 LOAD_CONST              41 (&#x27;Bye bye~~&#x27;)</span><br><span class="line">            144 CALL_FUNCTION            1      // print(&#x27;Bye bye~~&#x27;)</span><br><span class="line">            146 POP_TOP</span><br><span class="line"></span><br><span class="line"> 15         148 LOAD_NAME                7 (exit)</span><br><span class="line">            150 CALL_FUNCTION            0</span><br><span class="line">            152 POP_TOP                        // exit()</span><br><span class="line"></span><br><span class="line"> 16     &gt;&gt;  154 LOAD_NAME                8 (list)</span><br><span class="line">            156 LOAD_NAME                4 (str)</span><br><span class="line">            158 CALL_FUNCTION            1</span><br><span class="line">            160 STORE_NAME               9 (st)  // st = list(str)</span><br><span class="line"></span><br><span class="line"> 17         162 BUILD_LIST               0</span><br><span class="line">            164 STORE_NAME              10 (key) // key = []</span><br><span class="line"></span><br><span class="line"> 18         166 LOAD_NAME                0 (keyinit)</span><br><span class="line">            168 LOAD_NAME               10 (key)</span><br><span class="line">            170 CALL_FUNCTION            1</span><br><span class="line">            172 POP_TOP                         // key = keyinit()</span><br><span class="line"></span><br><span class="line"> 19         174 SETUP_LOOP              48 (to 224)</span><br><span class="line">            176 LOAD_NAME               11 (range)</span><br><span class="line">            178 LOAD_CONST              36 (32)</span><br><span class="line">            180 CALL_FUNCTION            1</span><br><span class="line">            182 GET_ITER</span><br><span class="line">        &gt;&gt;  184 FOR_ITER                36 (to 222)</span><br><span class="line">            186 STORE_NAME              12 (i)  // for i in range(32)</span><br><span class="line"></span><br><span class="line"> 20         188 LOAD_NAME               13 (ord)</span><br><span class="line">            190 LOAD_NAME                4 (str)</span><br><span class="line">            192 LOAD_NAME               12 (i)</span><br><span class="line">            194 BINARY_SUBSCR</span><br><span class="line">            196 CALL_FUNCTION            1     // TOS = ord(str[i])   </span><br><span class="line">            198 LOAD_NAME               10 (key)</span><br><span class="line">            200 LOAD_NAME               12 (i)</span><br><span class="line">            202 LOAD_NAME                6 (len)</span><br><span class="line">            204 LOAD_NAME               10 (key)</span><br><span class="line">            206 CALL_FUNCTION            1    // TOS = len(key)</span><br><span class="line">            208 BINARY_MODULO                 // TOS = i % len(key)</span><br><span class="line">            210 BINARY_SUBSCR                 // TOS = key[i % len(key)]</span><br><span class="line">            212 BINARY_XOR                    // TOS = ord(str[i]) ^ key[i % len(key)]</span><br><span class="line">            214 LOAD_NAME                9 (st)</span><br><span class="line">            216 LOAD_NAME               12 (i)</span><br><span class="line">            218 STORE_SUBSCR                  // st[i] = ord(str[i]) ^ key[i % len(key)]</span><br><span class="line">            220 JUMP_ABSOLUTE          184</span><br><span class="line">        &gt;&gt;  222 POP_BLOCK</span><br><span class="line"></span><br><span class="line"> 21     &gt;&gt;  224 LOAD_NAME                9 (st)</span><br><span class="line">            226 LOAD_NAME                5 (text)</span><br><span class="line">            228 COMPARE_OP               2 (==)</span><br><span class="line">            230 POP_JUMP_IF_FALSE      242    // if(st == text)</span><br><span class="line"></span><br><span class="line"> 22         232 LOAD_NAME                2 (print)</span><br><span class="line">            234 LOAD_CONST              42 (&#x27;Congratulations and you are good at PYC!&#x27;)</span><br><span class="line">            236 CALL_FUNCTION            1    // print(&#x27;Congratulations and you are good at PYC!&#x27;)</span><br><span class="line">            238 POP_TOP</span><br><span class="line">            240 JUMP_FORWARD             8 (to 250)</span><br><span class="line"></span><br><span class="line"> 24     &gt;&gt;  242 LOAD_NAME                2 (print)</span><br><span class="line">            244 LOAD_CONST              43 (&#x27;Sorry,plz learn more about pyc.&#x27;)</span><br><span class="line">            246 CALL_FUNCTION            1    // print(&#x27;Sorry,plz learn more about pyc.&#x27;)</span><br><span class="line">            248 POP_TOP                        </span><br><span class="line">        &gt;&gt;  250 LOAD_CONST              44 (None)</span><br><span class="line">            252 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object keyinit at 0x0000028C1CC11D20, file &quot;crackPYC.py&quot;, line 1&gt;:</span><br><span class="line">  2           0 LOAD_CONST               1 (0)</span><br><span class="line">              2 STORE_FAST               1 (num)    //num=0</span><br><span class="line"></span><br><span class="line">  3           4 SETUP_LOOP              42 (to 48)</span><br><span class="line">              6 LOAD_GLOBAL              0 (range)</span><br><span class="line">              8 LOAD_CONST               2 (8)</span><br><span class="line">             10 CALL_FUNCTION            1</span><br><span class="line">             12 GET_ITER</span><br><span class="line">        &gt;&gt;   14 FOR_ITER                30 (to 46)</span><br><span class="line">             16 STORE_FAST               2 (i)      //for i in range(8)</span><br><span class="line"></span><br><span class="line">  4          18 LOAD_FAST                1 (num)</span><br><span class="line">             20 LOAD_CONST               3 (7508399208111569251)</span><br><span class="line">             22 BINARY_SUBTRACT</span><br><span class="line">             24 LOAD_CONST               4 (4294967295)</span><br><span class="line">             26 BINARY_MODULO</span><br><span class="line">             28 STORE_FAST               1 (num)    // num=(num-7508399208111569251)%4294967295</span><br><span class="line"></span><br><span class="line">  5          30 LOAD_FAST                0 (key)</span><br><span class="line">             32 LOAD_METHOD              1 (append)</span><br><span class="line">             34 LOAD_FAST                1 (num)</span><br><span class="line">             36 LOAD_CONST               5 (24)</span><br><span class="line">             38 BINARY_RSHIFT</span><br><span class="line">             40 CALL_METHOD              1          // key.append(num&gt;&gt;24)</span><br><span class="line">             42 POP_TOP</span><br><span class="line">             44 JUMP_ABSOLUTE           14</span><br><span class="line">        &gt;&gt;   46 POP_BLOCK</span><br><span class="line">        &gt;&gt;   48 LOAD_CONST               0 (None)</span><br><span class="line">             50 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>对各汇编语句进行分析之后，原始 py 文件的大致意思也就出来了：使用 keyinit 函数生成 8 个数字储存在列表 key 中，将输入字符串的字符转为 ascii 码值之后利用 key 进行循环异或，将最后得到的结果和 text 进行比较。exp 也可以出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">key=[]</span><br><span class="line">for i in range(8):</span><br><span class="line">   num=(num-7508399208111569251)%4294967295</span><br><span class="line">   key.append(num&gt;&gt;24)</span><br><span class="line"></span><br><span class="line">text=[108,17,42,226,158,180,96,115,64,24,38,236,179,173,34,22,81,113,38,215,165,135,68,7,119,97,45,254,250,172,43,62]</span><br><span class="line"></span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for i in range(32):</span><br><span class="line">    flag+=chr(text[i]^key[i % len(key)] )</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h3 id="增加亿点点难度">增加亿点点难度</h3>
<p>题目来源：hgame2022 babyPyc</p>
<p>首先利用工具对 pyc 文件进行反编译，看看是否能够直接获得 py 文件，但是不管是 uncompyle6 还是 pycdc 都寄了（hhh，那就只能用通过 dis.dis() 获得 python 汇编来分析了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import dis, marshal</span><br><span class="line">&gt;&gt;&gt; with open(&quot;babyPyc.pyc&quot;, &#x27;rb&#x27;) as fp:</span><br><span class="line">...     print(fp.read(16))  // 读取前16字节的 pyc 文件头</span><br><span class="line">...     raw = marshal.loads(fp.read())</span><br><span class="line">...     print(dis.dis(raw))</span><br><span class="line">...</span><br><span class="line">b&#x27;B\r\r\n\x00\x00\x00\x00\xdaR%^ \x04\x00\x00&#x27; //此为 pyc 文件头</span><br><span class="line">  3           0 JUMP_ABSOLUTE            2</span><br><span class="line">        &gt;&gt;    2 LOAD_CONST               0 (0)</span><br><span class="line">              4 LOAD_CONST               1 (None)</span><br><span class="line">              6 IMPORT_NAME              0 (os)</span><br><span class="line">              8 STORE_NAME               0 (os)</span><br><span class="line">             10 LOAD_CONST               0 (0)</span><br><span class="line">             12 LOAD_CONST               1 (None)</span><br><span class="line">             14 IMPORT_NAME              1 (sys)</span><br><span class="line"></span><br><span class="line">  4          16 STORE_NAME               1 (sys)</span><br><span class="line">             18 LOAD_CONST               0 (0)</span><br><span class="line">             20 LOAD_CONST               2 ((&#x27;b64encode&#x27;,))</span><br><span class="line">             22 IMPORT_NAME              2 (base64)</span><br><span class="line">             24 IMPORT_FROM              3 (b64encode)</span><br><span class="line">             26 STORE_NAME               3 (b64encode)</span><br><span class="line"></span><br><span class="line">  6          28 POP_TOP</span><br><span class="line">             30 LOAD_CONST               3 (b&#x27;/KDq6pvN/LLq6tzM/KXq59Oh/MTqxtOTxdrqs8OoR3V1X09J&#x27;)</span><br><span class="line"></span><br><span class="line">  8          32 STORE_GLOBAL             4 (O0o)</span><br><span class="line">             34 LOAD_CONST               4 (&lt;code object getFlag at 0x000001CB0B452030, file &quot;task.py&quot;, line 8&gt;)</span><br><span class="line">             36 LOAD_CONST               5 (&#x27;getFlag&#x27;)</span><br><span class="line">             38 MAKE_FUNCTION            0</span><br><span class="line"></span><br><span class="line"> 16          40 STORE_NAME               5 (getFlag)</span><br><span class="line">             42 LOAD_NAME                5 (getFlag)</span><br><span class="line">             44 CALL_FUNCTION            0</span><br><span class="line"></span><br><span class="line"> 18          46 STORE_NAME               6 (flag)</span><br><span class="line">             48 LOAD_NAME                6 (flag)</span><br><span class="line">             50 LOAD_CONST               1 (None)</span><br><span class="line">             52 LOAD_CONST               6 (6)</span><br><span class="line">             54 BUILD_SLICE              2</span><br><span class="line">             56 BINARY_SUBSCR</span><br><span class="line">             58 LOAD_CONST               7 (b&#x27;hgame&#123;&#x27;)</span><br><span class="line">             60 COMPARE_OP               3 (!=)</span><br><span class="line">             62 POP_JUMP_IF_TRUE        76</span><br><span class="line">             64 LOAD_NAME                6 (flag)</span><br><span class="line">             66 LOAD_CONST               8 (-1)</span><br><span class="line">             68 BINARY_SUBSCR</span><br><span class="line">             70 LOAD_CONST               9 (125)</span><br><span class="line">             72 COMPARE_OP               3 (!=)</span><br><span class="line"></span><br><span class="line"> 19          74 POP_JUMP_IF_FALSE       94</span><br><span class="line">        &gt;&gt;   76 LOAD_NAME                7 (print)</span><br><span class="line">             78 LOAD_CONST              10 (&#x27;Incorrect format!&#x27;)</span><br><span class="line">             80 CALL_FUNCTION            1</span><br><span class="line"></span><br><span class="line"> 20          82 POP_TOP</span><br><span class="line">             84 LOAD_NAME                1 (sys)</span><br><span class="line">             86 LOAD_METHOD              8 (exit)</span><br><span class="line">             88 LOAD_CONST              11 (1)</span><br><span class="line">             90 CALL_METHOD              1</span><br><span class="line"></span><br><span class="line"> 22          92 POP_TOP</span><br><span class="line">        &gt;&gt;   94 LOAD_NAME                6 (flag)</span><br><span class="line">             96 LOAD_CONST               6 (6)</span><br><span class="line">             98 LOAD_CONST               8 (-1)</span><br><span class="line">            100 BUILD_SLICE              2</span><br><span class="line">            102 BINARY_SUBSCR</span><br><span class="line"></span><br><span class="line"> 23         104 STORE_NAME               9 (raw_flag)</span><br><span class="line">            106 LOAD_NAME               10 (len)</span><br><span class="line">            108 LOAD_NAME                6 (flag)</span><br><span class="line">            110 CALL_FUNCTION            1</span><br><span class="line">            112 LOAD_CONST              12 (7)</span><br><span class="line">            114 BINARY_SUBTRACT</span><br><span class="line">            116 LOAD_CONST              13 (36)</span><br><span class="line">            118 COMPARE_OP               3 (!=)</span><br><span class="line"></span><br><span class="line"> 24         120 POP_JUMP_IF_FALSE      140</span><br><span class="line">            122 LOAD_NAME                7 (print)</span><br><span class="line">            124 LOAD_CONST              14 (&#x27;Wrong length!&#x27;)</span><br><span class="line">            126 CALL_FUNCTION            1</span><br><span class="line"></span><br><span class="line"> 25         128 POP_TOP</span><br><span class="line">            130 LOAD_NAME                1 (sys)</span><br><span class="line">            132 LOAD_METHOD              8 (exit)</span><br><span class="line">            134 LOAD_CONST              15 (2)</span><br><span class="line">            136 CALL_METHOD              1</span><br><span class="line"></span><br><span class="line"> 27         138 POP_TOP</span><br><span class="line">        &gt;&gt;  140 LOAD_NAME                9 (raw_flag)</span><br><span class="line">            142 LOAD_CONST               1 (None)</span><br><span class="line">            144 LOAD_CONST               1 (None)</span><br><span class="line">            146 LOAD_CONST               8 (-1)</span><br><span class="line">            148 BUILD_SLICE              3</span><br><span class="line">            150 BINARY_SUBSCR</span><br><span class="line"></span><br><span class="line"> 28         152 STORE_NAME               9 (raw_flag)</span><br><span class="line">            154 LOAD_CONST              16 (&lt;code object &lt;listcomp&gt; at 0x000001CB0B44DE40, file &quot;task.py&quot;, line 28&gt;)</span><br><span class="line">            156 LOAD_CONST              17 (&#x27;&lt;listcomp&gt;&#x27;)</span><br><span class="line">            158 MAKE_FUNCTION            0</span><br><span class="line">            160 LOAD_NAME               11 (range)</span><br><span class="line">            162 LOAD_CONST               6 (6)</span><br><span class="line">            164 CALL_FUNCTION            1</span><br><span class="line">            166 GET_ITER</span><br><span class="line">            168 CALL_FUNCTION            1</span><br><span class="line"></span><br><span class="line"> 30         170 STORE_NAME              12 (ciphers)</span><br><span class="line">            172 SETUP_LOOP              86 (to 260)</span><br><span class="line">            174 LOAD_NAME               11 (range)</span><br><span class="line">            176 LOAD_CONST              18 (5)</span><br><span class="line">            178 CALL_FUNCTION            1</span><br><span class="line">            180 GET_ITER</span><br><span class="line">        &gt;&gt;  182 FOR_ITER                74 (to 258)</span><br><span class="line"></span><br><span class="line"> 31         184 STORE_NAME              13 (row)</span><br><span class="line">            186 SETUP_LOOP              68 (to 256)</span><br><span class="line">            188 LOAD_NAME               11 (range)</span><br><span class="line">            190 LOAD_CONST               6 (6)</span><br><span class="line">            192 CALL_FUNCTION            1</span><br><span class="line">            194 GET_ITER</span><br><span class="line">        &gt;&gt;  196 FOR_ITER                56 (to 254)</span><br><span class="line"></span><br><span class="line"> 32         198 STORE_NAME              14 (col)</span><br><span class="line">            200 LOAD_NAME               12 (ciphers)</span><br><span class="line">            202 LOAD_NAME               13 (row)</span><br><span class="line">            204 BINARY_SUBSCR</span><br><span class="line">            206 LOAD_NAME               14 (col)</span><br><span class="line">            208 DUP_TOP_TWO</span><br><span class="line">            210 BINARY_SUBSCR</span><br><span class="line">            212 LOAD_NAME               12 (ciphers)</span><br><span class="line">            214 LOAD_NAME               13 (row)</span><br><span class="line">            216 LOAD_CONST              11 (1)</span><br><span class="line">            218 BINARY_ADD</span><br><span class="line">            220 BINARY_SUBSCR</span><br><span class="line">            222 LOAD_NAME               14 (col)</span><br><span class="line">            224 BINARY_SUBSCR</span><br><span class="line">            226 INPLACE_ADD</span><br><span class="line">            228 ROT_THREE</span><br><span class="line"></span><br><span class="line"> 33         230 STORE_SUBSCR</span><br><span class="line">            232 LOAD_NAME               12 (ciphers)</span><br><span class="line">            234 LOAD_NAME               13 (row)</span><br><span class="line">            236 BINARY_SUBSCR</span><br><span class="line">            238 LOAD_NAME               14 (col)</span><br><span class="line">            240 DUP_TOP_TWO</span><br><span class="line">            242 BINARY_SUBSCR</span><br><span class="line">            244 LOAD_CONST              19 (256)</span><br><span class="line">            246 INPLACE_MODULO</span><br><span class="line">            248 ROT_THREE</span><br><span class="line">            250 STORE_SUBSCR</span><br><span class="line">            252 JUMP_ABSOLUTE          196</span><br><span class="line">        &gt;&gt;  254 POP_BLOCK</span><br><span class="line">        &gt;&gt;  256 JUMP_ABSOLUTE          182</span><br><span class="line"></span><br><span class="line"> 35     &gt;&gt;  258 POP_BLOCK</span><br><span class="line">        &gt;&gt;  260 LOAD_CONST              20 (b&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line"> 36         262 STORE_NAME              15 (cipher)</span><br><span class="line">            264 SETUP_LOOP              70 (to 336)</span><br><span class="line">            266 LOAD_NAME               11 (range)</span><br><span class="line">            268 LOAD_CONST               6 (6)</span><br><span class="line">            270 CALL_FUNCTION            1</span><br><span class="line">            272 GET_ITER</span><br><span class="line">        &gt;&gt;  274 FOR_ITER                58 (to 334)</span><br><span class="line"></span><br><span class="line"> 37         276 STORE_NAME              13 (row)</span><br><span class="line">            278 LOAD_CONST               0 (0)</span><br><span class="line"></span><br><span class="line"> 38         280 STORE_NAME              14 (col)</span><br><span class="line">            282 SETUP_LOOP              46 (to 330)</span><br><span class="line">        &gt;&gt;  284 LOAD_NAME               14 (col)</span><br><span class="line">            286 LOAD_CONST               6 (6)</span><br><span class="line">            288 COMPARE_OP               0 (&lt;)</span><br><span class="line">            290 EXTENDED_ARG             1</span><br><span class="line"></span><br><span class="line"> 39         292 POP_JUMP_IF_FALSE      328</span><br><span class="line">            294 LOAD_NAME               15 (cipher)</span><br><span class="line">            296 LOAD_NAME               16 (bytes)</span><br><span class="line">            298 LOAD_NAME               12 (ciphers)</span><br><span class="line">            300 LOAD_NAME               13 (row)</span><br><span class="line">            302 BINARY_SUBSCR</span><br><span class="line">            304 LOAD_NAME               14 (col)</span><br><span class="line">            306 BINARY_SUBSCR</span><br><span class="line">            308 BUILD_LIST               1</span><br><span class="line">            310 CALL_FUNCTION            1</span><br><span class="line">            312 INPLACE_ADD</span><br><span class="line"></span><br><span class="line"> 40         314 STORE_NAME              15 (cipher)</span><br><span class="line">            316 LOAD_NAME               14 (col)</span><br><span class="line">            318 LOAD_CONST              11 (1)</span><br><span class="line">            320 INPLACE_ADD</span><br><span class="line">            322 STORE_NAME              14 (col)</span><br><span class="line">            324 EXTENDED_ARG             1</span><br><span class="line">            326 JUMP_ABSOLUTE          284</span><br><span class="line">        &gt;&gt;  328 POP_BLOCK</span><br><span class="line">        &gt;&gt;  330 EXTENDED_ARG             1</span><br><span class="line">            332 JUMP_ABSOLUTE          274</span><br><span class="line"></span><br><span class="line"> 42     &gt;&gt;  334 POP_BLOCK</span><br><span class="line">        &gt;&gt;  336 LOAD_NAME                3 (b64encode)</span><br><span class="line">            338 LOAD_NAME               15 (cipher)</span><br><span class="line">            340 CALL_FUNCTION            1</span><br><span class="line"></span><br><span class="line"> 44         342 STORE_NAME              15 (cipher)</span><br><span class="line">            344 LOAD_NAME               15 (cipher)</span><br><span class="line">            346 LOAD_GLOBAL              4 (O0o)</span><br><span class="line">            348 COMPARE_OP               2 (==)</span><br><span class="line">            350 EXTENDED_ARG             1</span><br><span class="line"></span><br><span class="line"> 45         352 POP_JUMP_IF_FALSE      364</span><br><span class="line">            354 LOAD_NAME                7 (print)</span><br><span class="line">            356 LOAD_CONST              21 (&#x27;Great, this is my flag.&#x27;)</span><br><span class="line">            358 CALL_FUNCTION            1</span><br><span class="line">            360 POP_TOP</span><br><span class="line"></span><br><span class="line"> 47         362 JUMP_FORWARD             8 (to 372)</span><br><span class="line">        &gt;&gt;  364 LOAD_NAME                7 (print)</span><br><span class="line">            366 LOAD_CONST              22 (&#x27;Wrong flag.&#x27;)</span><br><span class="line">            368 CALL_FUNCTION            1</span><br><span class="line">            370 POP_TOP</span><br><span class="line">        &gt;&gt;  372 LOAD_CONST               1 (None)</span><br><span class="line">            374 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object getFlag at 0x000001CB0B452030, file &quot;task.py&quot;, line 8&gt;:</span><br><span class="line"> 10           0 LOAD_GLOBAL              0 (print)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;Give me the flag&#x27;)</span><br><span class="line">              4 CALL_FUNCTION            1</span><br><span class="line">              6 POP_TOP</span><br><span class="line"></span><br><span class="line"> 11           8 LOAD_GLOBAL              1 (input)</span><br><span class="line">             10 LOAD_CONST               2 (&#x27;&gt; &#x27;)</span><br><span class="line">             12 CALL_FUNCTION            1</span><br><span class="line">             14 STORE_FAST               0 (flag)</span><br><span class="line"></span><br><span class="line"> 12          16 LOAD_FAST                0 (flag)</span><br><span class="line">             18 LOAD_METHOD              2 (encode)</span><br><span class="line">             20 CALL_METHOD              0</span><br><span class="line">             22 STORE_FAST               0 (flag)</span><br><span class="line"></span><br><span class="line"> 13          24 LOAD_CONST               3 (b&#x27;QreZsrN+Wp3C0rJ4ccfXpJO8n9jIkIDNrteuxK6pR3JPZX5Q&#x27;)</span><br><span class="line">             26 STORE_GLOBAL             3 (O0o)</span><br><span class="line"></span><br><span class="line"> 14          28 LOAD_FAST                0 (flag)</span><br><span class="line">             30 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x000001CB0B44DE40, file &quot;task.py&quot;, line 28&gt;:</span><br><span class="line"> 28           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                26 (to 32)</span><br><span class="line">              6 STORE_DEREF              0 (col)</span><br><span class="line">              8 LOAD_CLOSURE             0 (col)</span><br><span class="line">             10 BUILD_TUPLE              1</span><br><span class="line">             12 LOAD_CONST               0 (&lt;code object &lt;listcomp&gt; at 0x000001CB0B44D150, file &quot;task.py&quot;, line 28&gt;)</span><br><span class="line">             14 LOAD_CONST               1 (&#x27;&lt;listcomp&gt;.&lt;listcomp&gt;&#x27;)</span><br><span class="line">             16 MAKE_FUNCTION            8</span><br><span class="line">             18 LOAD_GLOBAL              0 (range)</span><br><span class="line">             20 LOAD_CONST               2 (6)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 GET_ITER</span><br><span class="line">             26 CALL_FUNCTION            1</span><br><span class="line">             28 LIST_APPEND              2</span><br><span class="line">             30 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   32 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x000001CB0B44D150, file &quot;task.py&quot;, line 28&gt;:</span><br><span class="line"> 28           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                20 (to 26)</span><br><span class="line">              6 STORE_FAST               1 (row)</span><br><span class="line">              8 LOAD_GLOBAL              0 (raw_flag)</span><br><span class="line">             10 LOAD_CONST               0 (6)</span><br><span class="line">             12 LOAD_FAST                1 (row)</span><br><span class="line">             14 BINARY_MULTIPLY</span><br><span class="line">             16 LOAD_DEREF               0 (col)</span><br><span class="line">             18 BINARY_ADD</span><br><span class="line">             20 BINARY_SUBSCR</span><br><span class="line">             22 LIST_APPEND              2</span><br><span class="line">             24 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   26 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>python 汇编很长，在这里就不做一一分析了，对照下面的所还原出来的 py 文件内容，大致就可以读懂了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,sys</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line">O0o=<span class="string">b&#x27;/KDq6pvN/LLq6tzM/KXq59Oh/MTqxtOTxdrqs8OoR3V1X09J&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getFlag</span>():</span><br><span class="line">     <span class="keyword">global</span> O0o</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&#x27;Give me the flag&#x27;</span>)</span><br><span class="line">     flag=<span class="built_in">input</span>(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">     flag=flag.encode()</span><br><span class="line">     O0o=<span class="string">b&#x27;QreZsrN+Wp3C0rJ4ccfXpJO8n9jIkIDNrteuxK6pR3JPZX5Q&#x27;</span></span><br><span class="line">     <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag=getFlag()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[:<span class="number">6</span>]!=<span class="string">&#x27;hgame&#123;&#x27;</span> <span class="keyword">or</span> flag[-<span class="number">1</span>]!=<span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&#x27;Incorrect format!&#x27;</span>)</span><br><span class="line">     sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">raw_flag=flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(flag)-<span class="number">7</span> != <span class="number">36</span>):</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&#x27;Wrong length&#x27;</span>)</span><br><span class="line">     sys.exit(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">raw_flag=raw_flag[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">ciphers=[ [raw_flag[row*<span class="number">6</span>+col] <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)] <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)]            </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">     <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">          ciphers[row][col]=(ciphers[row+<span class="number">1</span>][col] + ciphers[row][col]) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line">cipher=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">     col=<span class="number">0</span></span><br><span class="line">     <span class="keyword">while</span>(col&lt;<span class="number">6</span>):</span><br><span class="line">          cipher+=<span class="built_in">bytes</span>([ciphers[row][col]])</span><br><span class="line">          col+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">cipher=b64encode(cipher)</span><br><span class="line"><span class="keyword">if</span>(cipher == O0o):</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&#x27;Great, this is my flag.&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&quot;Wrong flag.&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>感觉这一块最难的就是能从 python 汇编中看出 ciphers 的获取，这里面涉及到了列表推导式，其实现在我也看不太懂这个东西到底是怎么出来的（x</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ciphers=[ [raw_flag[row*6+col] for row in range(6)] for col in range(6)]</span><br><span class="line"># 列表生成的方式: 从里到外，一维一维生成的，一个[ ]就是一维</span><br><span class="line"># 每一维中元素的个数就是[ ]中 range() 的个数</span><br><span class="line"># 在本题中 ciphers 里的元素和 raw_flag 的元素位置对应关系如下</span><br><span class="line">  	  | 0  1  2  3  4  5</span><br><span class="line">	—— —— —— —— —— —— ——</span><br><span class="line">	0 | 0  6 12 18 24 30</span><br><span class="line">	1 | 1  7 13 19 25 31</span><br><span class="line">	2 | 2  8 14 20 26 32</span><br><span class="line">	3 | 3  9 15 21 27 33</span><br><span class="line">	4 | 4 10 16 22 28 34</span><br><span class="line">	5 | 5 11 17 23 29 35</span><br><span class="line"># 就相当于是做了一个转置的操作</span><br></pre></td></tr></table></figure>
<p>看明白这个，那么写 exp 也就没什么问题了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,sys</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">aim=<span class="string">b&#x27;QreZsrN+Wp3C0rJ4ccfXpJO8n9jIkIDNrteuxK6pR3JPZX5Q&#x27;</span></span><br><span class="line">aim=b64decode(aim)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphers=[[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)]</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        ciphers[row].append(aim[row*<span class="number">6</span>+col])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>,-<span class="number">1</span>,-<span class="number">1</span>): </span><br><span class="line">        <span class="keyword">if</span>(ciphers[row][col]-ciphers[row+<span class="number">1</span>][col] &lt; <span class="number">0</span>):</span><br><span class="line">            ciphers[row][col]=ciphers[row][col]+<span class="number">256</span>-ciphers[row+<span class="number">1</span>][col]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ciphers[row][col]-=ciphers[row+<span class="number">1</span>][col]</span><br><span class="line"></span><br><span class="line">ciphers = [ [ ciphers[row][col] <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>) ] <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)]   //转置回正确是顺序</span><br><span class="line"></span><br><span class="line">                              </span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">     flag+=<span class="built_in">chr</span>(ciphers[row][col])</span><br><span class="line"></span><br><span class="line">flag=flag[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="小结-v2">小结</h2>
<p>目前 python 汇编接触到的还没有很难，也更加了解了 python 一些其他知识，例如：接触到了列表推导式，python 汇编中函数的调用形式 …</p>
<p>依旧存在着一些问题：</p>
<ul>
<li>
<p>列表推导式对应的 python 汇编了解依旧不是很清晰</p>
</li>
<li>
<p>对于 hgame 中的那一道题目，python 汇编语言的第一句是 <code>3           0 JUMP_ABSOLUTE            2</code></p>
<p>其实这句话算是一句干扰，它可以导致反编译工具无法使用，如果我可以通过二进制文件编辑器将这句汇编语言所对应的机器码给 nop 掉并且修改掉 pyc 头部中的相关信息，再使用反编译工具去进行工作是不是就可以直接得到 py 文件🤔 感觉之后可以尝试一下</p>
</li>
</ul>

    </div>
    
    <div class="post__license">
        <p>
            <strong>本文作者：</strong>GhDemi
        </p>
        <p>
            <strong>
                本文链接：
            </strong>
            <a href="https://ghdemi.github.io/2022/11/05/Python%E9%80%86%E5%90%91/">https://ghdemi.github.io/2022/11/05/Python%E9%80%86%E5%90%91/</a>
        </p>
        
            <strong>
                <p>文章默认使用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 协议进行许可，使用时请注意遵守协议。</p>

            </strong>
        
    </div>
 
    <div class="post-footer__meta"><p>更新于 2022-11-05</p></div> 
    <div class="post-entry__tags"><a href="/tags/Knowledge/" class="post-tags__link button"># Knowledge</a></div> 
</article>


    <div class="nav">
        <div class="nav__prev">
            
                <a href="/2022/12/27/Android%E6%9D%82%E8%AE%B0/" class="nav__link">
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M589.088 790.624L310.464 512l278.624-278.624 45.248 45.248L400.96 512l233.376 233.376z" fill="#808080"></path></svg>
                    </div>
                    <div>
                        <div class="nav__label">
                            Previous Post
                        </div>
                        <div class="nav__title">
                            Android杂记
                        </div>
                    </div>
                </a>
            
        </div>
        <div class="nav__next">
            
                <a href="/2022/10/26/VM%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%80%86%E5%90%91/" class="nav__link">
                    <div>
                        <div class="nav__label">
                            Next Post
                        </div>
                        <div class="nav__title">
                            VM虚拟机逆向
                        </div>
                    </div>
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg>
                    </div>
                </a>
            
        </div>
    </div>





</main>

            <footer class="footer">
     
    <a href="#" class="button" id="b2t" aria-label="回到顶部" title="回到顶部">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M233.376 722.752L278.624 768 512 534.624 745.376 768l45.248-45.248L512 444.128zM192 352h640V288H192z" fill="currentColor"></path>
        </svg>
    </a>

    


    
     
 

 
    
        
        <p class="footer-copyright">
            Copyright © 2022&nbsp;-&nbsp;2023 <a href="/">早点睡zZZ</a>
        </p>
    
    
    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p>
</footer>

        </div>
         

 

 

 

 



 



 


    
 


    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.css">

    
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.js"></script>

    <script>
        let lazyloadT = Boolean('false'),
            auto_fancybox = Boolean('true')
        if (auto_fancybox) {
            $(".post__content").find('img').each(function () {
                var element = document.createElement("a");
                $(element).attr("data-fancybox", "gallery");
                $(element).attr("href", $(this).attr("src"));
                if (lazyloadT) {
                    $(element).attr("href", $(this).attr("data-srcset"));
                }
                $(this).wrap(element);
            });
        } else {
            $(".post__content").find("fancybox").find('img').each(function () {
                var element = document.createElement("a");
                $(element).attr("data-fancybox", "gallery");
                $(element).attr("href", $(this).attr("src"));
                if (lazyloadT) {
                    $(element).attr("href", $(this).attr("data-srcset"));
                }
                $(this).wrap(element);
            });
        }
    </script>
 

 

 

 

 




    </body>
</html>
